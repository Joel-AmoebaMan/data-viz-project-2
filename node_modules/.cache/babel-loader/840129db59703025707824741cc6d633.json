{"ast":null,"code":"import*as d3 from'd3';import moment from'moment';import React,{useEffect,useRef}from'react';import useDeathDays from'./DeathDays';import{jsx as _jsx}from\"react/jsx-runtime\";var DeathChart=function DeathChart(){var margin={top:10,right:20,bottom:30,left:30},height=200-margin.top-margin.bottom;var deathDays=useDeathDays({});var svg=useRef(d3.selectAll(\"div\"));var x;var y;var graph=function graph(){var formatValue=d3.format(\",\");if(svg.current){svg.current.append(\"path\").datum(deathDays).attr(\"fill\",\"none\").attr(\"stroke\",\"red\").attr(\"stroke-width\",1.5)//@ts-ignore\n.attr(\"d\",d3.line().x(function(d){return x(d3.timeParse(\"%Y-%m-%d\")(d.date));}).y(function(d){return y(d.deaths);}));var focus=svg.current.append(\"g\").attr(\"class\",\"focus\").style(\"display\",\"none\");var mousemove=function mousemove(e){var x0=x.invert(d3.pointer(e)[0]);var res=deathDays.find(function(element){return moment(element.date).format('Y-M-D')===moment(x0).format('Y-M-D');});if(res){focus.attr(\"transform\",\"translate(\"+x(d3.timeParse(\"%Y-%m-%d\")(res.date))+\",\"+y(res.deaths)+\")\");focus.select(\".tooltip-date\").text(res.date);focus.select(\".tooltip-likes\").text(formatValue(res.deaths));}};focus.append(\"circle\").attr(\"r\",5);focus.append(\"rect\").attr(\"class\",\"tooltip\").attr(\"width\",100).attr(\"height\",50).attr(\"x\",10).attr(\"y\",-22).attr(\"rx\",4).attr(\"ry\",4).style(\"position\",\"absolute\").style(\"zIndex\",100);focus.append(\"text\").attr(\"class\",\"tooltip-date\").attr(\"x\",18).attr(\"y\",-2);focus.append(\"text\").attr(\"x\",18).attr(\"y\",18).text(\"Deaths:\");focus.append(\"text\").attr(\"class\",\"tooltip-likes\").attr(\"x\",75).attr(\"y\",18);var chart=d3.selectAll('#death-chart');//@ts-ignore\nvar width=chart.node().getBoundingClientRect().width-90;svg.current.append(\"rect\").attr(\"class\",\"overlay\").attr(\"width\",width).attr(\"height\",height).on(\"mouseover\",function(){focus.style(\"display\",null);}).on(\"mouseout\",function(){focus.style(\"display\",\"none\");}).on(\"mousemove\",mousemove);}};var draw=function draw(){var s=d3.selectAll('#death-chart svg g');var chart=d3.selectAll('#death-chart');s=s.remove();//@ts-ignore\nvar width=chart.node().getBoundingClientRect().width-90;//@ts-ignore\nsvg.current=d3.select(\"#death-chart svg\").attr(\"width\",width).attr(\"height\",height+margin.top+margin.bottom).append(\"g\").attr(\"transform\",\"translate(\"+margin.left+\",\"+margin.top+\")\");var dates=deathDays.map(function(d){return new Date(d.date);});var domain=d3.extent(dates);x=d3.scaleTime()//@ts-ignore\n.domain(domain).range([0,width]);var xAxis=d3.axisBottom(x);svg.current.append(\"g\").attr(\"transform\",\"translate(0,\"+height+\")\")//@ts-ignore\n.call(xAxis.ticks(d3.timeDay.every(4)).tickFormat(d3.timeFormat('%m/%d')));y=d3.scaleLinear()//@ts-ignore\n.domain([0,d3.max(deathDays,function(d){return+d.deaths+20;})]).range([height,0]);svg.current.append(\"g\").call(d3.axisLeft(y));graph();};useEffect(function(){draw();d3.select(window).on(\"resize\",function(){draw();});},[]);useEffect(function(){graph();},[deathDays]);return/*#__PURE__*/_jsx(\"div\",{id:\"death-chart\",style:{overflow:'visible'},children:/*#__PURE__*/_jsx(\"svg\",{width:\"100%\",style:{overflow:'visible'}})});};export default DeathChart;","map":{"version":3,"names":["d3","moment","React","useEffect","useRef","useDeathDays","DeathChart","margin","top","right","bottom","left","height","deathDays","svg","selectAll","x","y","graph","formatValue","format","current","append","datum","attr","line","d","timeParse","date","deaths","focus","style","mousemove","e","x0","invert","pointer","res","find","element","select","text","chart","width","node","getBoundingClientRect","on","draw","s","remove","dates","map","Date","domain","extent","scaleTime","range","xAxis","axisBottom","call","ticks","timeDay","every","tickFormat","timeFormat","scaleLinear","max","axisLeft","window","overflow"],"sources":["/Users/spaul/dev/london/my-app/src/DeathChart.tsx"],"sourcesContent":["import * as d3 from 'd3';\nimport moment from 'moment';\nimport React, { useEffect, useRef } from 'react';\nimport useDeathDays from './DeathDays';\n\nconst DeathChart = () => {\n    const margin = {top: 10, right: 20, bottom: 30, left: 30},\n            height = 200 - margin.top - margin.bottom;\n    const deathDays = useDeathDays({});\n    let svg = useRef(d3.selectAll(\"div\"));\n\n    \n    let x: any;\n    let y: any;\n\n    const graph = () => {\n        let formatValue = d3.format(\",\");\n\n        if (svg.current) {\n            svg.current.append(\"path\")\n            .datum(deathDays)\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", \"red\")\n            .attr(\"stroke-width\", 1.5)\n            //@ts-ignore\n            .attr(\"d\", d3.line()\n                .x((d: any) => x(d3.timeParse(\"%Y-%m-%d\")(d.date)))\n                .y((d: any) => y(d.deaths))\n            )\n\n        var focus = svg.current.append(\"g\")\n            .attr(\"class\", \"focus\")\n            .style(\"display\", \"none\");\n\n        const mousemove = (e:any) => {\n            let x0 = x.invert(d3.pointer(e)[0]);\n            let res = deathDays.find((element) => moment(element.date).format('Y-M-D') === moment(x0).format('Y-M-D'));\n            if (res) {\n                focus.attr(\"transform\", \"translate(\" + x(d3.timeParse(\"%Y-%m-%d\")(res.date)) + \",\" + y(res.deaths) + \")\");\n                focus.select(\".tooltip-date\").text(res.date);\n                focus.select(\".tooltip-likes\").text(formatValue(res.deaths));\n            }\n            \n        }\n\n        focus.append(\"circle\")\n            .attr(\"r\", 5);\n\n        focus.append(\"rect\")\n            .attr(\"class\", \"tooltip\")\n            .attr(\"width\", 100)\n            .attr(\"height\", 50)\n            .attr(\"x\", 10)\n            .attr(\"y\", -22)\n            .attr(\"rx\", 4)\n            .attr(\"ry\", 4)\n            .style(\"position\", \"absolute\")\n            .style(\"zIndex\", 100);\n\n        focus.append(\"text\")\n            .attr(\"class\", \"tooltip-date\")\n            .attr(\"x\", 18)\n            .attr(\"y\", -2);\n\n        focus.append(\"text\")\n            .attr(\"x\", 18)\n            .attr(\"y\", 18)\n            .text(\"Deaths:\");\n\n        focus.append(\"text\")\n            .attr(\"class\", \"tooltip-likes\")\n            .attr(\"x\", 75)\n            .attr(\"y\", 18);\n\n        var chart = d3.selectAll('#death-chart');\n        //@ts-ignore\n        var width = chart.node().getBoundingClientRect().width - 90;\n        svg.current.append(\"rect\")\n            .attr(\"class\", \"overlay\")\n            .attr(\"width\", width)\n            .attr(\"height\", height)\n            .on(\"mouseover\", function() { focus.style(\"display\", null); })\n            .on(\"mouseout\", function() { focus.style(\"display\", \"none\"); })\n            .on(\"mousemove\", mousemove);\n        }\n    }\n\n    const draw = () => {\n        var s = d3.selectAll('#death-chart svg g');\n        var chart = d3.selectAll('#death-chart');\n        s = s.remove();\n        //@ts-ignore\n        var width = chart.node().getBoundingClientRect().width - 90;\n        //@ts-ignore\n        svg.current = d3.select(\"#death-chart svg\")\n            .attr(\"width\", width)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\",\n                \"translate(\" + margin.left + \",\" + margin.top + \")\");\n        const dates = deathDays.map(d => new Date(d.date));\n        const domain = d3.extent(dates);\n        x = d3.scaleTime()\n        //@ts-ignore\n        .domain(domain)\n        .range([ 0, width ]);\n\n        const xAxis = d3.axisBottom(x);\n\n        svg.current.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        //@ts-ignore\n        .call(xAxis.ticks(d3.timeDay.every(4)).tickFormat(d3.timeFormat('%m/%d')));\n\n        y = d3.scaleLinear()\n        //@ts-ignore\n        .domain([0, d3.max(deathDays, (d) => +d.deaths + 20)])\n        .range([ height, 0 ]);\n\n        svg.current.append(\"g\")\n        .call(d3.axisLeft(y));\n\n        graph();\n    }\n\n    useEffect(() => {\n        draw();\n        \n        d3.select(window)\n            .on(\"resize\", function() {\n                draw();\n            });\n    },[]);\n\n    useEffect(() => {\n        graph();\n    },[deathDays]);\n\n    return (\n        <div id=\"death-chart\" style={{ overflow: 'visible' }}>\n            <svg width=\"100%\" style={{ overflow: 'visible' }}></svg>\n        </div>\n    )\n}\n\nexport default DeathChart;"],"mappings":"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"},"metadata":{},"sourceType":"module"}